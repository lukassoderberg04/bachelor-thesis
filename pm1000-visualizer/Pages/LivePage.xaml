<UserControl x:Class="pm1000_visualizer.Pages.LivePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ScottPlot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
             xmlns:h="clr-namespace:HelixToolkit.Wpf;assembly=HelixToolkit.Wpf"
             Background="#FF28292B">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>         <!-- Header bar -->
            <RowDefinition Height="3*"/>           <!-- Poincaré + info -->
            <RowDefinition Height="Auto"/>         <!-- Controls row -->
            <RowDefinition Height="2*"/>           <!-- Processed Audio -->
            <RowDefinition Height="Auto"/>         <!-- Overlay button -->
            <RowDefinition Height="2*"/>           <!-- Raw Audio -->
        </Grid.RowDefinitions>

        <!-- ═══ Row 0: Header ═══════════════════════════════════════════════ -->
        <Grid Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel>
                <TextBlock Text="PM1000 Live" FontSize="20" FontWeight="Bold" Foreground="White"/>
                <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                    <Ellipse Width="8" Height="8" Fill="#FF90EE90" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBlock Text="Connected" Foreground="#FF90EE90" VerticalAlignment="Center"/>
                    <TextBlock Text="  │  Streamer: " Foreground="#FFAAAAAA"/>
                    <TextBlock x:Name="StreamerIpText" Foreground="White" Text="-"/>
                    <TextBlock Text="  │  Freq: " Foreground="#FFAAAAAA"/>
                    <TextBlock x:Name="FreqText" Foreground="White" Text="-"/>
                    <TextBlock Text="  │  SR: " Foreground="#FFAAAAAA"/>
                    <TextBlock x:Name="SampleRateText" Foreground="White" Text="-"/>
                    <TextBlock Text="  │  Elapsed: " Foreground="#FFAAAAAA"/>
                    <TextBlock x:Name="ElapsedText" Foreground="White" Text="0:00"/>
                </StackPanel>
            </StackPanel>

            <Button Grid.Column="1"
                    Content="■  STOP"
                    Style="{StaticResource DangerButton}"
                    FontSize="14"
                    Padding="18,8"
                    Click="StopButton_Click"/>
        </Grid>

        <!-- ═══ Row 1: Poincaré sphere + Stokes info ═════════════════════ -->
        <Grid Grid.Row="1" Margin="0,0,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="220"/>
            </Grid.ColumnDefinitions>

            <Border BorderThickness="1" BorderBrush="#FF555555" CornerRadius="4">
                <h:HelixViewport3D x:Name="PoincareView"
                                   ShowCoordinateSystem="True"
                                   CoordinateSystemLabelForeground="White"/>
            </Border>

            <!-- Stokes parameter readout -->
            <StackPanel Grid.Column="1" Margin="14,0,0,0">
                <TextBlock Text="Polarization" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="PolarizationText" Text="—" Style="{StaticResource ValueLabel}" Margin="0,0,0,12"/>

                <TextBlock Text="DOP" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="DopText" Text="—" Style="{StaticResource ValueLabel}" Margin="0,0,0,12"/>

                <TextBlock Text="Power" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="PowerText" Text="— µW" Style="{StaticResource ValueLabel}" Margin="0,0,0,12"/>

                <TextBlock Text="S1" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="S1Text" Text="—" Style="{StaticResource ValueLabel}" Margin="0,0,0,12"/>

                <TextBlock Text="S2" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="S2Text" Text="—" Style="{StaticResource ValueLabel}" Margin="0,0,0,12"/>

                <TextBlock Text="S3" Style="{StaticResource InfoLabel}"/>
                <TextBlock x:Name="S3Text" Text="—" Style="{StaticResource ValueLabel}" Margin="0,0,0,0"/>
            </StackPanel>
        </Grid>

        <!-- ═══ Row 2: Controls ══════════════════════════════════════════ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,2,0,6">
            <Button x:Name="NormalizedRawButton"
                    Content="Normalized"
                    Style="{StaticResource DarkButton}"
                    Click="NormalizedRaw_Click"/>
            <Button Content="Reset View"
                    Style="{StaticResource DarkButton}"
                    Margin="8,0"
                    Click="ResetView_Click"/>
            <CheckBox x:Name="TrailCheckBox"
                      Content="Trail"
                      IsChecked="True"
                      Style="{StaticResource DarkCheckBox}"
                      VerticalAlignment="Center"
                      Margin="8,0"/>
        </StackPanel>

        <!-- ═══ Row 3: Processed Audio ═══════════════════════════════════ -->
        <Border Grid.Row="3" BorderThickness="1" BorderBrush="#FF555555" CornerRadius="4" Margin="0,0,0,2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Margin="10,5">
                    <TextBlock Text="Processed Audio  (Port " Foreground="White" FontWeight="SemiBold"/>
                    <TextBlock x:Name="ProcessedPortText" Foreground="White" FontWeight="SemiBold" Text="5002"/>
                    <TextBlock Text=")" Foreground="White" FontWeight="SemiBold"/>
                    <Button x:Name="ProcGraphBtn" Content="Graph"
                            Style="{StaticResource DarkButton}" Margin="20,0,0,0"
                            IsEnabled="False" FontSize="11" Padding="8,3"/>
                    <Button x:Name="ProcSpecBtn" Content="Spec"
                            Style="{StaticResource DarkButton}" Margin="4,0,0,0"
                            FontSize="11" Padding="8,3"
                            Click="ProcSpec_Click"/>
                </StackPanel>

                <ScottPlot:WpfPlot x:Name="ProcessedAudioPlot" Grid.Row="1"/>
            </Grid>
        </Border>

        <!-- ═══ Row 4: Overlay reference button ═════════════════════════ -->
        <Button x:Name="OverlayButton" Grid.Row="4"
                Content="Overlay Reference"
                Style="{StaticResource DarkButton}"
                HorizontalAlignment="Left"
                FontSize="11" Padding="10,4"
                Margin="0,2"
                Click="OverlayReference_Click"/>

        <!-- ═══ Row 5: Raw Reference Audio ═══════════════════════════════ -->
        <Border Grid.Row="5" BorderThickness="1" BorderBrush="#FF555555" CornerRadius="4" Margin="0,4,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Margin="10,5">
                    <TextBlock Text="Raw Reference Audio  (Port " Foreground="White" FontWeight="SemiBold"/>
                    <TextBlock x:Name="RawPortText" Foreground="White" FontWeight="SemiBold" Text="5001"/>
                    <TextBlock Text=")" Foreground="White" FontWeight="SemiBold"/>
                    <Button Content="Graph"
                            Style="{StaticResource DarkButton}" Margin="20,0,0,0"
                            IsEnabled="False" FontSize="11" Padding="8,3"/>
                    <Button Content="Spec"
                            Style="{StaticResource DarkButton}" Margin="4,0,0,0"
                            FontSize="11" Padding="8,3"
                            Click="RawSpec_Click"/>
                </StackPanel>

                <ScottPlot:WpfPlot x:Name="RawAudioPlot" Grid.Row="1"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
